%global tar_version @TAR_VERSION@

Name: java-ovirt-engine-sdk4
Version: @RPM_VERSION@
Release: @RPM_RELEASE@
Summary: Java SDK for version 4 of the oVirt Engine API
Group: Development/Languages
License: ASL 2.0
URL: http://ovirt.org/wiki/SDK
Source0: @TAR_URL@
Source1: build.xml

BuildArch: noarch

BuildRequires: ant
BuildRequires: mvn(com.sun.xml.txw2:txw2)
BuildRequires: mvn(org.apache.httpcomponents:httpclient)
BuildRequires: mvn(org.apache.httpcomponents:httpcore)
BuildRequires: mvn(org.codehaus.jackson:jackson-core-asl)
BuildRequires: mvn(org.codehaus.jackson:jackson-mapper-asl)
BuildRequires: mvn(org.slf4j:slf4j-api)

Requires: mvn(com.sun.xml.txw2:txw2)
Requires: mvn(org.apache.httpcomponents:httpclient)
Requires: mvn(org.apache.httpcomponents:httpcore)
Requires: mvn(org.codehaus.jackson:jackson-core-asl)
Requires: mvn(org.codehaus.jackson:jackson-mapper-asl)
Requires: mvn(org.slf4j:slf4j-api)

%description
This package contains the Java SDK for version 4 of the oVirt Engine
API.

%prep

# Extract the source:
%setup -q -n ovirt-engine-sdk-java-%{tar_version}

%build
# Copy Ant build file to the extracted SDK directory and modify
# apache java classes to appropriate supported version:
cp %{SOURCE1} build.xml

# Populate the lib directory with symlinks to the required dependencies that
# will be used to create the compiler classpath:
mkdir lib
while read jar
do
  ln -s %{_javadir}/${jar}.jar lib
done << __EOF__
httpcomponents/httpclient
httpcomponents/httpcore
jackson/jackson-core-asl
jackson/jackson-mapper-asl
slf4j/api
txw2
__EOF__

# Perform build using Ant:
java -jar %{_javadir}/ant-launcher.jar -f build.xml build42

%install
# Install the files:
install -d -m 755 %{buildroot}%{_javadir}/%{name}
install -pm 644 target/%{name}.jar %{buildroot}%{_javadir}/%{name}/sdk.jar

%files
%doc README.adoc
%license LICENSE.txt
%{_javadir}/%{name}

%changelog
* Thu Apr 7 2016 Juan Hernandez <juan.hernandez@redhat.com> - 4.0.0
- Initial packaging.
